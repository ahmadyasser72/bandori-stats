---
import { STAT_COLUMNS } from "@bandori-stats/database/constants";
import { titleCase } from "text-case";

import BaseLayout from "~/layouts/base-layout.astro";
---

<BaseLayout>
	<div class="absolute inset-0 overflow-x-auto">
		<table class="table-xs table-zebra table">
			<thead>
				<tr hx-disabled-elt="input" hx-indicator="#full-loader, tbody">
					<th></th>
					<th></th>
					<th>Rank by</th>

					{
						STAT_COLUMNS.map((column) => (
							<td>
								<input
									type="checkbox"
									class="btn checked:btn-accent not-checked:btn-outline btn-xs border"
									name="by"
									value={column}
									aria-label={titleCase(column)}
									checked
									hx-get="/leaderboard/1"
									hx-include="closest tr"
									hx-sync="closest tr:replace"
									hx-target="tbody"
									hx-trigger="change delay:500ms"
								/>
							</td>
						))
					}
				</tr>
				<tr class="bg-base-100 sticky top-0 z-10">
					<th class="min-w-10"></th>
					<th class="min-w-40">Username</th>
					<th class="min-w-24">Last Updated</th>

					{STAT_COLUMNS.map((column) => <th>{titleCase(column)}</th>)}
				</tr>
			</thead>

			<tbody hx-indicator=".infinite-placeholder">
				<tr hx-get="/leaderboard/1" hx-trigger="revealed" hx-swap="outerHTML"
				></tr>
			</tbody>

			<tfoot>
				{
					Array.from({ length: 12 }, () => (
						<tr class="infinite-placeholder htmx-indicator">
							{Array.from({ length: 3 + STAT_COLUMNS.length }, () => (
								<td>
									<div class="skeleton h-4" />
								</td>
							))}
						</tr>
					))
				}
			</tfoot>
		</table>

		<div class="center fixed">
			<img
				id="full-loader"
				src="/spinners/grid.svg"
				alt="Loading entries..."
				class="htmx-indicator mx-auto mt-[20%]"
			/>
		</div>
	</div>
</BaseLayout>
