---
import { STAT_COLUMNS } from "@bandori-stats/database/constants";
import { titleCase } from "text-case";

import BaseLayout from "~/layouts/base-layout.astro";
---

<BaseLayout>
	<div class="absolute inset-0 overflow-x-auto">
		<div class="sticky left-0 z-20 flex items-center gap-2 p-4 pb-2 sm:px-8">
			<h1 class="text-xl font-bold">Leaderboard</h1>

			<div class="dropdown max-sm:dropdown-center">
				<div tabindex="0" class="btn btn-primary btn-circle btn-sm">
					<iconify-icon icon="lucide:cog" width="16"></iconify-icon>
				</div>

				<form
					hx-get="/leaderboard/1"
					hx-target="tbody"
					hx-disabled-elt="input, button"
					hx-indicator="#full-loader, tbody"
					class="dropdown-content card card-sm bg-base-100 z-10 mt-1 w-64 shadow-sm"
				>
					<div class="card-body">
						<h2 class="card-title">Options</h2>

						<fieldset
							class="fieldset bg-base-200 border-base-300 rounded-box border p-4"
						>
							<legend class="fieldset-legend py-0">Rank by</legend>
							<div class="flex flex-wrap gap-1">
								{
									STAT_COLUMNS.map((column) => (
										<input
											type="checkbox"
											class="btn btn-xs checked:btn-accent btn-outline"
											name="rank_by"
											value={column}
											aria-label={titleCase(column.replace(/Count$/, ""))}
										/>
									))
								}
							</div>
						</fieldset>

						<div class="card-actions">
							<button class="btn btn-sm btn-primary">Apply</button>
						</div>
					</div>
				</form>
			</div>
		</div>

		<table class="table-xs table-zebra table">
			<thead>
				<tr class="bg-base-100 sticky top-0 z-10">
					<th class="min-w-10"></th>
					<th class="min-w-42">Username</th>
					<th class="min-w-24">Last Updated</th>

					{STAT_COLUMNS.map((column) => <th>{titleCase(column)}</th>)}
				</tr>
			</thead>

			<tbody hx-indicator=".infinite-placeholder">
				<tr hx-get="/leaderboard/1" hx-trigger="revealed" hx-swap="outerHTML"
				></tr>
			</tbody>

			<tfoot>
				{
					Array.from({ length: 12 }, () => (
						<tr class="infinite-placeholder htmx-indicator">
							{Array.from({ length: 3 + STAT_COLUMNS.length }, () => (
								<td>
									<div class="skeleton h-4" />
								</td>
							))}
						</tr>
					))
				}
			</tfoot>
		</table>

		<div
			id="full-loader"
			class="htmx-indicator center rounded-box fixed bg-white/80 p-4"
		>
			<img src="/spinners/grid.svg" alt="Loading entries..." />
		</div>
	</div>
</BaseLayout>

<dialog id="stats-dialog" class="modal"></dialog>
